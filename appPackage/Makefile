# Makefile pour la gestion des ic√¥nes et packages Microsoft Teams
# Assistant GPT Teams - Cotechnoe Inc.

.PHONY: help icons clean backup restore package validate info

# Couleurs pour l'affichage
BLUE := \033[0;34m
GREEN := \033[0;32m
YELLOW := \033[0;33m
RED := \033[0;31m
NC := \033[0m # No Color

help: ## Afficher cette aide
	@echo "$(BLUE)‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê$(NC)"
	@echo "$(GREEN)  Makefile - Assistant GPT Teams (Cotechnoe)$(NC)"
	@echo "$(BLUE)‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê$(NC)"
	@echo ""
	@echo "$(YELLOW)Commandes disponibles:$(NC)"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "  $(GREEN)%-15s$(NC) %s\n", $$1, $$2}'
	@echo ""

icons: ## G√©n√©rer les ic√¥nes Teams (color.png, outline.png)
	@echo "$(BLUE)üé® G√©n√©ration des ic√¥nes Microsoft Teams...$(NC)"
	@python3 generate-icons.py
	@echo "$(GREEN)‚úÖ Ic√¥nes g√©n√©r√©es avec succ√®s!$(NC)"
	@echo ""
	@echo "$(YELLOW)üìù Prochaines √©tapes:$(NC)"
	@echo "  1. V√©rifier visuellement les ic√¥nes: color.png et outline.png"
	@echo "  2. Reg√©n√©rer les packages: make package"
	@echo "  3. Tester dans Teams: make validate"

package: icons ## G√©n√©rer les packages Teams (.zip) avec les nouvelles ic√¥nes
	@echo "$(BLUE)üì¶ G√©n√©ration des packages Microsoft Teams...$(NC)"
	@rm -f build/appPackage.dev.zip build/appPackage.playground.zip
	@mkdir -p build
	@zip -q build/appPackage.dev.zip manifest.json color.png outline.png
	@cp build/appPackage.dev.zip build/appPackage.playground.zip
	@echo "$(GREEN)‚úÖ Packages g√©n√©r√©s:$(NC)"
	@ls -lh build/appPackage.*.zip | awk '{printf "  - %s (%s)\n", $$9, $$5}'
	@echo ""
	@unzip -l build/appPackage.dev.zip | grep -E '(Length|color|outline|manifest)' || true

validate: ## Valider les ic√¥nes (dimensions, format, conformit√©)
	@echo "$(BLUE)üîç Validation des ic√¥nes...$(NC)"
	@echo ""
	@echo "$(YELLOW)Sp√©cifications Microsoft Teams:$(NC)"
	@echo "  Color icon:   256x256 px (recommand√© 216-350px), symbole 160x160 px, padding 48 px"
	@echo "  Outline icon: 32x32 px, blanc RGB(255,255,255), transparent"
	@echo ""
	@echo "$(YELLOW)Fichiers actuels:$(NC)"
	@file color.png outline.png 2>/dev/null || echo "  $(RED)‚ùå Ic√¥nes non trouv√©es$(NC)"
	@echo ""
	@if command -v identify >/dev/null 2>&1; then \
		echo "$(YELLOW)D√©tails (ImageMagick):$(NC)"; \
		identify -format "  color.png:   %wx%h px, %[channels], %[colorspace], %b\n" color.png 2>/dev/null || true; \
		identify -format "  outline.png: %wx%h px, %[channels], %[colorspace], %b\n" outline.png 2>/dev/null || true; \
	else \
		echo "$(YELLOW)‚ÑπÔ∏è  Installer ImageMagick pour validation d√©taill√©e:$(NC)"; \
		echo "  sudo apt-get install imagemagick"; \
	fi
	@echo ""
	@if [ -f build/appPackage.dev.zip ]; then \
		echo "$(GREEN)‚úÖ Package Teams trouv√©:$(NC)"; \
		ls -lh build/appPackage.dev.zip | awk '{printf "  %s (%s)\n", $$9, $$5}'; \
	else \
		echo "$(YELLOW)‚ö†Ô∏è  Package non g√©n√©r√©. Ex√©cuter: make package$(NC)"; \
	fi

backup: ## Sauvegarder les ic√¥nes actuelles (.backup)
	@echo "$(BLUE)üì¶ Sauvegarde des ic√¥nes...$(NC)"
	@if [ -f color.png ]; then \
		cp color.png color.png.backup; \
		echo "$(GREEN)‚úÖ color.png ‚Üí color.png.backup$(NC)"; \
	fi
	@if [ -f outline.png ]; then \
		cp outline.png outline.png.backup; \
		echo "$(GREEN)‚úÖ outline.png ‚Üí outline.png.backup$(NC)"; \
	fi

restore: ## Restaurer les anciennes ic√¥nes depuis backup
	@echo "$(YELLOW)üîÑ Restauration des ic√¥nes depuis backup...$(NC)"
	@if [ -f color.png.backup ]; then \
		mv color.png.backup color.png; \
		echo "$(GREEN)‚úÖ color.png restaur√©e$(NC)"; \
	else \
		echo "$(RED)‚ùå color.png.backup non trouv√©e$(NC)"; \
	fi
	@if [ -f outline.png.backup ]; then \
		mv outline.png.backup outline.png; \
		echo "$(GREEN)‚úÖ outline.png restaur√©e$(NC)"; \
	else \
		echo "$(RED)‚ùå outline.png.backup non trouv√©e$(NC)"; \
	fi
	@echo ""
	@echo "$(YELLOW)üí° Reg√©n√©rer les packages: make package$(NC)"

clean: ## Nettoyer les fichiers g√©n√©r√©s (packages, backups)
	@echo "$(BLUE)üßπ Nettoyage des fichiers g√©n√©r√©s...$(NC)"
	@rm -f build/appPackage.dev.zip build/appPackage.playground.zip
	@rm -f *.backup
	@echo "$(GREEN)‚úÖ Nettoyage termin√©$(NC)"

info: ## Afficher les informations sur les ic√¥nes et packages
	@echo "$(BLUE)‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê$(NC)"
	@echo "$(GREEN)  Informations - Assistant GPT Teams$(NC)"
	@echo "$(BLUE)‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê$(NC)"
	@echo ""
	@echo "$(YELLOW)üìê Sp√©cifications Microsoft Teams:$(NC)"
	@echo "  Color icon (color.png):"
	@echo "    - Dimensions: 256x256 pixels (recommand√©: 216-350px)"
	@echo "    - Symbole: 160x160 pixels max (centr√©)"
	@echo "    - Padding: 48 pixels autour du symbole"
	@echo "    - Format: PNG RGBA (avec transparence)"
	@echo "    - Teams applique: coins arrondis, forme hexagonale (bots)"
	@echo ""
	@echo "  Outline icon (outline.png):"
	@echo "    - Dimensions: 32x32 pixels"
	@echo "    - Couleur: Blanc pur RGB(255, 255, 255) uniquement"
	@echo "    - Fond: Transparent (canal alpha = 0)"
	@echo "    - Pas de padding (symbole peut aller aux bords)"
	@echo "    - Utilisation: App bar Teams, indicateur 'en cours'"
	@echo ""
	@echo "$(YELLOW)üìÅ Fichiers:$(NC)"
	@ls -lh color.png outline.png 2>/dev/null | awk '{printf "  %s: %s (%s)\n", $$9, $$6" "$$7" "$$8, $$5}' || echo "  $(RED)‚ùå Ic√¥nes non trouv√©es$(NC)"
	@echo ""
	@if [ -d build ]; then \
		echo "$(YELLOW)üì¶ Packages Teams:$(NC)"; \
		ls -lh build/appPackage.*.zip 2>/dev/null | awk '{printf "  %s: %s (%s)\n", $$9, $$6" "$$7" "$$8, $$5}' || echo "  $(YELLOW)‚ö†Ô∏è  Aucun package g√©n√©r√©$(NC)"; \
	else \
		echo "$(YELLOW)üì¶ Packages Teams:$(NC)"; \
		echo "  $(YELLOW)‚ö†Ô∏è  R√©pertoire build/ non trouv√©$(NC)"; \
	fi
	@echo ""
	@echo "$(YELLOW)üîó R√©f√©rence:$(NC)"
	@echo "  https://learn.microsoft.com/microsoftteams/platform/concepts/build-and-test/apps-package#app-icons"
	@echo ""

# Cibles par d√©faut
.DEFAULT_GOAL := help
